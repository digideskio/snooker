"use strict";angular.module("app",["ngRoute","ngAnimate","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html"}).when("/rules",{templateUrl:"views/rules.html"}).when("/new",{templateUrl:"views/new-game.html"}).when("/game",{templateUrl:"views/game.html"}).when("/game/score/:playerId",{templateUrl:"views/score.html",controller:"ScoreCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("app").controller("WinnerModalCtrl",["$scope","$modalInstance","winner",function(a,b,c){a.winner=c,a.ok=function(){b.dismiss("Game over")}}]),angular.module("app").controller("ScoreCtrl",["$scope","$routeParams","$modal","$location","Game",function(a,b,c,d,e){function f(){0===a.player.getScore()&&a.goToNextPlayer()}e.setCurrentPlayerId(parseInt(b.playerId)),a.player=e.currentPlayer(),a.isWinner=function(){return a.player.getScore()===a.player.target},a.goToNextPlayer=function(){d.path("/game/score/"+e.getNextPlayerId())},a.declareWinner=function(){e.incrementTarget(),e.shufflePlayers(),d.path("/new"),c.open({templateUrl:"views/_winner-modal.html",controller:"WinnerModalCtrl",resolve:{winner:function(){return a.player}}})},a.undo=function(){e.undoPlayerScore()},a.cannon=function(){e.cannon(),f()},a.yellow=function(){e.yellow(),f()},a.green=function(){e.green(),f()},a.blue=function(){e.blue(),f()},a.pink=function(){e.pink(),f()},a.black=function(){e.black(),f()},a.brown=function(){e.brown(),f()},a.foul=function(){e.foul(),f()}}]),angular.module("app").factory("Game",["Player",function(a){var b={DEFAULT_TARGET:31,DEFAULT_INCREMENT:10,load:function(){var b=JSON.parse(localStorage.getItem("snookerGame"));this.currentPlayerId=b?b.currentPlayerId:0,this.players=[];var c=this;b&&angular.forEach(b.players,function(b){c.players.push(new a(b.name,b.target,{scoreEvents:b.scoreEvents}))})},persist:function(){localStorage.setItem("snookerGame",angular.toJson({updatedAt:(new Date).getTime(),players:this.players,currentPlayerId:this.currentPlayerId}))},currentPlayer:function(){return this.players[this.currentPlayerId]},addPlayer:function(b,c){this.players.push(new a(b,c)),this.persist()},removePlayer:function(a){var b=this.players.splice(a,1)[0];return this.persist(),b},setCurrentPlayerId:function(a){this.currentPlayerId=a,this.persist()},getNextPlayerId:function(){var a=this.currentPlayerId+1;return a<this.players.length?a:0},shufflePlayers:function(){for(var a=this.players.length-1;a>0;a--){var b=Math.floor(Math.random()*(a+1)),c=this.players[a];this.players[a]=this.players[b],this.players[b]=c}this.persist()},incrementTarget:function(){this.currentPlayer().target+=this.DEFAULT_INCREMENT,this.persist()},resetScores:function(){this.currentPlayerId=0,angular.forEach(this.players,function(a){a.resetScore()}),this.persist()},resetTargets:function(){var a=this.DEFAULT_TARGET;this.currentPlayerId=0,angular.forEach(this.players,function(b){b.target=a}),this.persist()},cannon:function(){this.addScoreToPlayer(2)},yellow:function(){this.addScoreToPlayer(2)},green:function(){this.addScoreToPlayer(3)},blue:function(){this.addScoreToPlayer(5)},pink:function(){this.addScoreToPlayer(6)},black:function(){this.addScoreToPlayer(7)},brown:function(){this.addFoulToPlayer()},foul:function(){this.addFoulToPlayer()},addScoreToPlayer:function(a){this.currentPlayer().addScore(a),this.persist()},addFoulToPlayer:function(){this.currentPlayer().foul(),this.persist()},undoPlayerScore:function(){this.currentPlayer().undoScore(),this.persist()}};return b.load(),b}]),angular.module("app").factory("Player",function(){var a=function(a,b,c){this.name=a,this.target=b,this.scoreEvents=c&&c.scoreEvents?c.scoreEvents:[],this.addScore=function(a){this.scoreEvents.push(a),this.isFoulScore()&&(this.scoreEvents.pop(),this.foul())},this.getScore=function(){var a=0;return angular.forEach(this.scoreEvents,function(b){b>0?a+=b:a=0}),a},this.resetScore=function(){this.scoreEvents=[]},this.undoScore=function(){this.scoreEvents.pop()},this.isFoulScore=function(){return this.getScore()>this.target||this.getScore()===this.target-1},this.foul=function(){this.scoreEvents.push(0)}};return a}),angular.module("app").directive("scoreboard",function(){return{restrict:"E",templateUrl:"views/_scoreboard.html",scope:{leadText:"=lead"},controller:["$scope","$location","Game",function(a,b,c){a.currentPlayerId=c.currentPlayerId,a.players=c.players,a.scorePlayer=function(a){b.path("/game/score/"+a)}}]}}),angular.module("app").directive("addPlayer",function(){return{restrict:"E",templateUrl:"views/_add-player.html",controller:["$scope","$location","Game",function(a,b,c){a.playerName="",a.targetScore=c.DEFAULT_TARGET,a.addPlayer=function(){c.addPlayer(a.playerName,a.targetScore),a.playerName="",a.targetScore=c.DEFAULT_TARGET}}]}}),angular.module("app").directive("newGameButtons",function(){return{restrict:"E",templateUrl:"views/_new-game-buttons.html",controller:["$scope","$location","Game",function(a,b,c){a.players=c.players,a.resetScores=function(){c.resetScores()},a.resetTargets=function(){c.resetTargets()}}]}}),angular.module("app").directive("newGamePlayerTable",function(){return{restrict:"E",templateUrl:"views/_new-game-player-table.html",controller:["$scope","$location","Game",function(a,b,c){a.players=c.players,a.removePlayer=function(a){c.removePlayer(a)},a.editPlayer=function(b){var d=c.removePlayer(b);a.playerName=d.name,a.targetScore=d.target},a.shufflePlayers=function(){c.shufflePlayers()}}]}}),angular.module("app").directive("toggleBrightness",function(){return{restrict:"E",templateUrl:"views/_toggle-brightness.html",controller:["$scope",function(a){a.toggleBrightness=function(){document.querySelector("html").classList.toggle("dark-theme")}}]}});